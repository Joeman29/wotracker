(function(){window.WorkoutPlayer={Timers:[]},WorkoutPlayer.Player=function(){function e(){}return e.prototype.workoutTime=0,e.prototype.segmentTime=0,e.prototype.exerciseTime=0,e.prototype.playIndex=0,e.prototype.currSegIndex=0,e.prototype.setsLeft=0,e.prototype.setsDone=0,e.prototype.workout={},e.prototype.initialize=function(e){var t;return this.workout=e,t=this,$("#finished").click(function(){return t.scrollNextExercise()}),this.workoutTimer=this.setInterval(function(){var e;return this.workoutTime++,e=$("#workout-progress").progressbar("value"),$("#workout-progress").progressbar("value",e-1),$("#actual-workout-time").text(this.convertToTime(this.workoutTime))},1e3),this.segmentTimer=this.setInterval(function(){return this.segmentTime++},1e3),this.exerciseTimer=this.setInterval(function(){return this.exerciseTime++,$("#timer").text(this.convertToTime(this.exerciseTime)),$("#exercise-progress").progressbar("value",this.exerciseTime)},1e3),this.playWorkout()},e.prototype.playWorkout=function(){return 0===this.workout.segments.length?($("#segment-name").text("Error: No data in workout"),void 0):($($("#workout-outline").find(".exercise-name")[0]).addClass("current-exercise"),$($("#workout-outline").find(".segment-name")[0]).addClass("current-segment"),$("#exercise-progress").progressbar(),$("#workout-progress").progressbar({max:60*this.workout.goal_time,value:60*this.workout.goal_time}),this.setsLeft=this.workout.segments[0].sets,this.playSegment(this.workout.segments[0]))},e.prototype.playSegment=function(e){return this.playIndex=0,this.segmentTime=0,$("#segment-name").text(e.name),$("#segment-sets").text(""+e.sets+" Sets"),$("#segment-position").text(e.position),e.exercises.length?this.playExercise(e.exercises[0]):(this.currSegIndex++,this.workout.segments[this.currSegIndex]?this.playSegment(this.workout.segments[this.currSegIndex]):this.finishWorkout())},e.prototype.playExercise=function(e){var t,r;return this.exerciseTime=0,$("#exercise-description").text(e.descript),t=e.kind,$("#exercise-name").text(e.name),"Cardio/Aerobic"===t||"Stretch"===t?($("#exercise-time").show().text(e.time+" minute(s)"),$("#timer, #exercise-progress").show(),$("#exercise-progress").progressbar({value:0,max:60*e.time}),$("#finished").hide(),r=6e4*e.time,this.setTimeout(function(){return this.scrollNextExercise()},r)):($("#timer, #exercise-progress, #exercise-time").hide(),$("#finished").show())},e.prototype.scrollNextExercise=function(){var e;return this.workout.segments[this.currSegIndex].exercises[this.playIndex].timeset||(this.workout.segments[this.currSegIndex].exercises[this.playIndex].timeset=[]),this.workout.segments[this.currSegIndex].exercises[this.playIndex].timeset[this.setsDone]=this.exerciseTime,this.playIndex++,e=this.workout.segments[this.currSegIndex].exercises[this.playIndex],e?(this.advancePlayHead(),this.playExercise(e)):(this.setsLeft--,this.workout.segments[this.currSegIndex+1]||this.setsLeft?this.rest(this.workout.segments[this.currSegIndex].rest_time):this.finishWorkout())},e.prototype.rest=function(e){return this.advancePlayHead(),this.exerciseTime=0,$("#exercise-name").text("Rest for "+e+" seconds"),$("#timer, #exercise-progress").show(),$("#exercise-progress").progressbar({max:e}),$("#finished").hide(),this.setTimeout(function(){return this.setsDone++,this.workout.segments[this.currSegIndex].time=this.segmentTime,0===this.setsLeft?(this.currSegIndex++,this.setsLeft=this.workout.segments[this.currSegIndex].sets,this.setsDone=0,this.advancePlayHead(),this.advanceSegmentPlayHead()):this.resetSegmentOutline(),this.playSegment(this.workout.segments[this.currSegIndex])},1e3*e)},e.prototype.advancePlayHead=function(){var e;return e=$("#workout-outline").find(".current-exercise"),e.addClass("done").removeClass("not-done"),$(e.nextAll(".exercise-name, .rest")[0]).addClass("current-exercise"),e.removeClass("current-exercise")},e.prototype.advanceSegmentPlayHead=function(){var e;return e=$("#workout-outline").find(".current-segment"),e.addClass("done").removeClass("not-done"),e.removeClass("current-segment"),$(e.nextAll(".segment-name")[0]).addClass("current-segment")},e.prototype.resetSegmentOutline=function(){var e,t;return e=$(".current-exercise"),t=e.prevUntil(".current-segment",".exercise-name"),console.log(e),console.log(t),t.removeClass("done").addClass("not-done"),e.removeClass("current-exercise"),t.last().addClass("current-exercise")},e.prototype.finishWorkout=function(){var e,t,r,s;for($("#workout-play-start-area").hide(),this.workout.time=this.workoutTime,this.workout.completed_segments_attributes=this.workout.segments,delete this.workout.segments,s=this.workout.completed_segments_attributes,t=0,r=s.length;r>t;t++)e=s[t],e.completed_exercises_attributes=e.exercises,delete e.exercises;return console.log(JSON.stringify(this.workout)),this.stopTimers(),$.post($("#workout-play-area").data("return-url"),{workout:this.workout},function(e,t){return console.log(t)}),$("#finished").hide(),$("#done-workout").button().show()},e.prototype.stopTimers=function(){return WorkoutPlayer.Timers.forEach(function(e){return clearInterval(e)})},e.prototype.setInterval=function(e,t){return WorkoutPlayer.Timers.push(setInterval($.proxy(e,this),t))},e.prototype.setTimeout=function(e,t){return WorkoutPlayer.Timers.push(setTimeout($.proxy(e,this),t))},e.prototype.convertToTime=function(e){return""+("0"+Math.floor(e/60)).substr(-2)+":"+("0"+e%60).substr(-2)},e}(),$(document).on("myPageLoadEvent",function(){return $("#workout-play-start").click(function(){return $(this).hide(),$("#workout-play-start-area").dialog({width:"45%",position:{at:"center-5% top"},modal:!0}),$("#workout-meta").dialog({width:"30%",position:{at:"right top"}}),$("#workout-outline").dialog({width:"20%",position:{at:"left top"}}),$("#exercise-meta").dialog({width:"45%",position:{at:"center-5% center"}}),$.getJSON($("#workout-play-area").data("workout-url"),function(e){var t;return t=new WorkoutPlayer.Player,t.initialize(e)})})}),$(document).on("page:before-change",function(){return WorkoutPlayer.Timers.forEach(function(e){return clearInterval(e)})})}).call(this);